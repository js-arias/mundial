# Simulador del mundial

Resultados para un millón de simulaciones.
ELO indica el ELO al arrancar el campeonato,
y ELO final el ELO esperado al terminar.
P1, P2, P3 y P4 indican la probabilidad
de terminar en esa posición en la fase de grupos.
Oct, Ct, Sf y Fin indican la probabilidad de alcanzar
la fase de octavos, cuarto, semifinal y final respectivamente.
Camp indica la probabilidad de quedar campeón.
Goles indica el estimado de goles a favor y en contra.
Los valores de las probabilidades están en porcentaje.

Equipo | ELO | ELO final | P1 | P2 | P3 | P4 | Ocv | Ct | Sf | Fin | Camp | Goles
------ | --- | --------- | -- | -- | -- | -- | --- | -- | -- | --- | ---- | -----
Brasil | 2169 | 2211 | 99 | 0 | 0 | 0 | 100 | 91 | 69 | 48 | 36 | 10.2-3.9
Argentina | 2143 | 2113 | 74 | 13 | 12 | 0 | 87 | 68 | 46 | 22 | 14 | 8.6-5.3
Francia | 2005 | 2058 | 99 | 0 | 0 | 0 | 100 | 79 | 55 | 31 | 11 | 12.6-5.5
Portugal | 2006 | 2056 | 99 | 0 | 0 | 0 | 100 | 71 | 48 | 28 | 10 | 10.9-5.7
Países Bajos | 2040 | 2052 | 100 | 0 | 0 | 0 | 100 | 83 | 41 | 14 | 8 | 9.0-3.7
España | 2048 | 2062 | 90 | 8 | 1 | 0 | 98 | 73 | 25 | 13 | 7 | 13.3-4.2
Inglaterra | 1920 | 1970 | 100 | 0 | 0 | 0 | 100 | 79 | 31 | 13 | 3 | 12.6-4.6
Croacia | 1927 | 1939 | 40 | 25 | 34 | 0 | 65 | 32 | 12 | 5 | 1 | 6.9-3.9
Alemania | 1963 | 1935 | 0 | 59 | 5 | 34 | 59 | 31 | 12 | 5 | 1 | 5.4-5.3
Bélgica | 2007 | 1950 | 18 | 23 | 54 | 3 | 41 | 20 | 7 | 3 | 1 | 3.5-4.2
Suiza | 1902 | 1901 | 0 | 71 | 27 | 0 | 72 | 20 | 10 | 3 | 0 | 4.4-3.2
Dinamarca | 1971 | 1928 | 0 | 65 | 29 | 4 | 65 | 22 | 8 | 2 | 0 | 4.5-3.9
Marruecos | 1766 | 1849 | 41 | 51 | 7 | 0 | 92 | 29 | 6 | 2 | 0 | 5.7-2.6
Uruguay | 1936 | 1887 | 0 | 72 | 18 | 9 | 72 | 7 | 2 | 0 | 0 | 3.9-2.9
Serbia | 1898 | 1855 | 0 | 27 | 44 | 28 | 27 | 7 | 3 | 1 | 0 | 4.8-6.9
Polonia | 1814 | 1835 | 21 | 37 | 41 | 0 | 58 | 17 | 5 | 1 | 0 | 3.9-3.0
Estados Unidos | 1798 | 1831 | 0 | 100 | 0 | 0 | 100 | 16 | 4 | 0 | 0 | 4.3-2.1
Senegal | 1687 | 1765 | 0 | 100 | 0 | 0 | 100 | 20 | 3 | 0 | 0 | 7.2-5.3
México | 1809 | 1794 | 0 | 26 | 29 | 43 | 26 | 4 | 1 | 0 | 0 | 2.4-3.2
Costa Rica | 1743 | 1754 | 2 | 26 | 5 | 65 | 28 | 7 | 1 | 0 | 0 | 2.3-9.3
Japón | 1787 | 1786 | 7 | 4 | 87 | 0 | 12 | 4 | 0 | 0 | 0 | 2.7-4.4
Australia | 1719 | 1728 | 0 | 33 | 64 | 2 | 33 | 4 | 0 | 0 | 0 | 3.6-6.1
Arabia Saudita | 1635 | 1657 | 3 | 23 | 16 | 56 | 27 | 2 | 0 | 0 | 0 | 3.5-4.9
Corea del Sur | 1786 | 1745 | 0 | 2 | 10 | 86 | 2 | 0 | 0 | 0 | 0 | 2.5-5.2
Ghana | 1567 | 1607 | 0 | 24 | 71 | 4 | 24 | 0 | 0 | 0 | 0 | 6.2-7.1
Túnez | 1707 | 1690 | 0 | 0 | 5 | 93 | 0 | 0 | 0 | 0 | 0 | 0.3-3.3
Camerún | 1610 | 1621 | 0 | 0 | 28 | 71 | 0 | 0 | 0 | 0 | 0 | 3.1-6.5
Ecuador | 1833 | 1842 | 0 | 0 | 100 | 0 | 0 | 0 | 0 | 0 | 0 | 4.0-3.0
Irán | 1797 | 1779 | 0 | 0 | 100 | 0 | 0 | 0 | 0 | 0 | 0 | 4.0-7.0
Canadá | 1776 | 1728 | 0 | 0 | 3 | 96 | 0 | 0 | 0 | 0 | 0 | 1.9-6.7
Gales | 1790 | 1717 | 0 | 0 | 0 | 100 | 0 | 0 | 0 | 0 | 0 | 1.0-6.0
Catar | 1780 | 1678 | 0 | 0 | 0 | 100 | 0 | 0 | 0 | 0 | 0 | 1.0-7.0

En el archivo [resultados.md](resultados.md)
están los próximos partidos
así como los resultados más recientes.

## Funcionamiento del modelo

El modelo esta basado en los indices de ELO
compilados por [World Football ELO Ratings](https://www.eloratings.net/).

El modelo de ELO permite estimar la probabilidad
de que un equipo gane basado en la
[diferencia entre sus indices](https://en.wikipedia.org/wiki/World_Football_Elo_Ratings#Expected_result_of_match).

Sin embargo,
el modelo no estima el resultado en cuanto a los goles.
Para ello,
asumí que como en los últimos mundiales,
en este mundial el promedio de gol es 2.6 por partido.
De acuerdo con eso,
de acuerdo con la fuerza de cada equipo se le asigno un valor
de número estimado de goles,
de forma que en promedio ambos valores sumen 2.6.
Y asigne el valor al más cercano dada la expectativa de goles
y la [distribución de Poisson](https://en.wikipedia.org/wiki/Poisson_distribution):

Equipo fuerte | Equipo débil | Expectativa de victoria
------------- | ------------ | -----------------------
1.3 | 1.3 | 0.500
1.4 | 1.2 | 0.547
1.5 | 1.1 | 0.594
1.6 | 1.0 | 0.638
1.7 | 0.9 | 0.682
1.8 | 0.8 | 0.725
1.9 | 0.7 | 0.764
2.0 | 0.6 | 0.802
2.1 | 0.5 | 0.837
2.2 | 0.4 | 0.869
2.3 | 0.3 | 0.897
2.4 | 0.2 | 0.922
2.5 | 0.1 | 0.944

El código de esa simulación esta en el directorio `prob`.

Para el caso de la fase de eliminación directa,
en caso de empate se simulo el tiempo extra usando estos mismos valores,
pero escalados a 1/3
(dado que se juegan 30 minutos).

Para ordenar los grupos,
se utilizó el número de puntos,
en segundo lugar la diferencia de goles,
y después el número de goles anotados.
Si persistía el empate,
se uso un número de suerte al azar.

En la fase eliminatoria,
si luego del tiempo extra persistía el empate,
se escogió a alguno de los dos equipos al azar.

A medida que pasan los partidos,
el ELO de los equipos se actualizó
usando el procedimiento para
[calcular el número de puntos cambiados](https://en.wikipedia.org/wiki/World_Football_Elo_Ratings#Calculation_principles).
Dado que es la copa del mundo,
el factor de peso del partido fue de 60.

## Ejecutar la simulación

Para ejecutar la simulación se necesita `go`
usando la instrucción
(se puede compilar como una aplicación,
pero dado el uso poco seguido,
no vale la pena!):

~~~bash
go run catar-2022.go
~~~~

Con el parámetro `--sims` es posible indicar el número de simulaciones,
y con `--fmt` se puede indicar que produzca una tabla en `markdown`
usando `md`.

También es posible ejecutar la simulación de un solo partido
usando el código en `partido`.
Por ejemplo para simular Argentina vs. Brasil:

~~~bash
go run partido.go "Argentina" "Brasil"
~~~

Es posible estimar la probabilidad sabiendo el marcador
en un minuto determinado
(los minutos de cuentan hacía adelante desde 0 hasta 90,
o si hay tiempos suplementarios hasta 120):

~~~bash
go run partido.go -min 69 "Bélgica" "Brasil" "1-2"
~~~

Con la bandera `--sup` los empates se resuelven
con tiempo suplementario.

Como esta aplicación puede ser muy interesante
para ejecutar en un partido,
un código muy similar esta en el
[playground de go](https://go.dev/play/p/hEBq_4m3TuA).

## Interpretación

En el mundial pasado mucha gente bromeo
que podría tomar los resultados para apostar.
Yo diría que esto es de poca ayuda para las apuestas:
Los resultados son una expectativa basada en dos presupuestos
que no se cumplen en realidad:

* La simulación muestra el resultado de *el modelo*,
  que esperamos que se aproxime a la realidad.
* El torneo se juega muchas veces.
  El torneo real es solo un posible resultado
  de todos los resultados posibles.
  La simulación pretende aproximar todas esas posibles historias.

Aún si asumimos que el modelo es exacto,
la simulación ayudaría a que *en promedio*
a los apostadores les fuera mejor
que escogiendo resultados totalmente al azar.
Lo cual no implica que *en promedio*
esos apostadoran ganaran más de lo que perdieron.

En general,
los sistemas de apuestas funcionan
porque es poco probable ganar
(y por lo tanto el promotor de la apuesta se queda con el dinero).
Así que yo diría que mejor usar esta simulación
para el disfrute y apreciar el juego,
y no para realizar apuestas!

## Autor

Este código fue escrito por Salvador Arias,
utilizando los valores de ELO publicados en [World Football ELO Ratings](https://www.eloratings.net/).
